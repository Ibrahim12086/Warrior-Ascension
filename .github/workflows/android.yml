name: Final Fix
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-java@v4
        with: {java-version: '17', distribution: 'temurin'}

      - name: Reset And Build
        run: |
          # 1. مسح كل ملفات الإعدادات القديمة اللي بتسبب الخطأ
          rm -rf android .gradle
          
          # 2. بناء هيكل جديد تماماً
          mkdir -p android/app/src/main/java/com/ibrahim/warrior
          mkdir -p android/app/src/main/assets
          
          # 3. ملفات بناء "نظيفة" متوافقة مع Gradle 9
          echo "include ':app'" > android/settings.gradle
          echo "buildscript { repositories { google(); mavenCentral() }; dependencies { classpath 'com.android.tools.build:gradle:8.1.0' } }" > android/build.gradle
          echo "allprojects { repositories { google(); mavenCentral() } }" >> android/build.gradle
          
          cat <<APP > android/app/build.gradle
          plugins { id 'com.android.application' }
          android {
              namespace 'com.ibrahim.warrior'
              compileSdk 33
              defaultConfig { applicationId "com.ibrahim.warrior"; minSdk 24; targetSdk 33 }
          }
          dependencies { implementation 'androidx.appcompat:appcompat:1.6.1' }
          APP

          # 4. نقل ملفاتك وحل مشكلة الخروج (Crash)
          cp -r Content/* android/app/src/main/assets/ || true
          echo "package com.ibrahim.warrior; import android.app.Activity; public class MainActivity extends Activity {}" > android/app/src/main/java/com/ibrahim/warrior/MainActivity.java
          echo '<manifest xmlns:android="http://schemas.android.com/apk/res/android" package="com.ibrahim.warrior"><application><activity android:name=".MainActivity" android:exported="true"><intent-filter><action android:name="android.intent.action.MAIN"/><category android:name="android.intent.category.LAUNCHER"/></intent-filter></activity></application></manifest>' > android/app/src/main/AndroidManifest.xml

          # 5. البناء النهائي
          cd android
          gradle wrapper --gradle-version 8.0
          chmod +x gradlew
          ./gradlew assembleDebug --no-daemon

      - uses: actions/upload-artifact@v4
        with: {name: Warrior-Fixed, path: "android/app/build/outputs/apk/debug/*.apk"}
